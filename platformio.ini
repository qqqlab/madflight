;============================================================
; madflight PlatformIO Project Configuration File
;
; For madflight documentation see:
; https://madflight.com
;
; For PlatformIO documentation see:
; https://docs.platformio.org/page/projectconf.html
;============================================================

; SETUP - Copy ONE main.cpp and madflight_config.h from the examples directory to the src directory
; or create 'src/main.cpp' with one line: #include "../examples/00.HelloWorld/main.cpp"

[platformio]
; Uncomment ONE line to set the default env to compile, instead of "all environments"
;default_envs = ESP32
;default_envs = ESP32-S3
;default_envs = RP2040
;default_envs = RP2350A
;default_envs = RP2350B
;default_envs = STM32F411

[env]
; Default monitor speed for madflight is 115200
monitor_speed = 115200
monitor_echo = yes

;============================================================
; ESP32 TARGETS
;============================================================
; Note: Espressiv stopped Arduino framework support for PlatformIO. Arduino 2.x
; is the last supported framework version, but madflight should still compile with this.
;
; Alternatively you could use pioarduino to get Arduino 3.x, see:
; https://github.com/pioarduino/platform-espressif32
; https://github.com/sivar2311/platform-espressif32-versions

[env:ESP32]
board = esp32dev
platform = espressif32
framework = arduino
monitor_filters = esp32_exception_decoder

[env:ESP32-S3]
board = lolin_s3_mini
platform = espressif32
framework = arduino
monitor_filters = esp32_exception_decoder
build_flags =
    -D CONFIG_IDF_TARGET_ESP32S3
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=1

;============================================================
; RP2040/RP2350 TARGETS
;============================================================
; Note: RP2040/RP2350 is not merged into mainline PlatformIO, see 
; https://arduino-pico.readthedocs.io/en/latest/platformio.html
; on Windows you need to enable long path names, see above link for instructions
; on Windows you need to use Zadig to enable uploading

[env_rp2_base]
platform = https://github.com/maxgerhardt/platform-raspberrypi.git
framework = arduino
board_build.core = earlephilhower
; Enable FreeRTOS & TinyUSB
build_flags =
    -D PIO_FRAMEWORK_ARDUINO_ENABLE_FREERTOS
    -D USE_TINYUSB
; Use a recent arduino-pico version (the version included in maxgerhardt/platform-raspberrypi is lagging behind arduino-pico releases)
; Note: a fixed version is used here, not #master, to prevent long downloads each time the source repository is updated
platform_packages = framework-arduinopico@https://github.com/earlephilhower/arduino-pico.git#5.5.0

;optional Debugprobe debugger - see Appendix A "Getting started with Raspberry Pi Pico-series"
;debug_tool = cmsis-dap
;upload_protocol = cmsis-dap
;debug_speed = 30000
;build_type = debug

[env:RP2040]
extends = env_rp2_base
board = pico

[env:RP2350A]
extends = env_rp2_base
board = rpipico2

[env:RP2350B]
extends = env_rp2_base
board = solderparty_rp2350_stamp_xl

;============================================================
; STM32 TARGETS
;============================================================

[env:STM32F411]
board = blackpill_f411ce
platform = ststm32
framework = arduino
lib_deps = 
    ${env.lib_deps}
    stm32duino/STM32duino FreeRTOS
build_flags =
    -D SERIAL_RX_BUFFER_SIZE=256
    -D SERIAL_TX_BUFFER_SIZE=256
    -D MF_HACK_STM32_INTERRUPT_PRIORITY=1
